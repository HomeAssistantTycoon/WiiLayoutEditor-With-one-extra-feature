name: Build WiiLayoutEditor

on:
  workflow_dispatch:  # manual trigger

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup MSBuild path
        id: msbuild
        run: |
          Write-Host "Locating MSBuild using vswhere..."
          $vsPath = & 'C:\Program Files (x86)\Microsoft Visual Studio\Installer\vswhere.exe' -latest -products * -requires Microsoft.Component.MSBuild -property installationPath
          if (-not $vsPath) { throw "MSBuild not found via vswhere!" }
          $msbuildPath = Join-Path $vsPath 'MSBuild\Current\Bin\MSBuild.exe'
          Write-Host "MSBuild found at $msbuildPath"
          echo "::set-output name=path::$msbuildPath"

      - name: Build solution
        run: |
          $msbuild = "${{ steps.msbuild.outputs.path }}"
          Write-Host "Building WiiLayoutEditor.sln using MSBuild..."
          & $msbuild WiiLayoutEditor.sln /nologo /t:Build /p:Configuration=Release /p:Platform="Any CPU"

      - name: List output files
        run: |
          Write-Host "Contents of Release folder:"
          Get-ChildItem -Recurse .\WiiLayoutEditor\bin\Release

      - name: Upload Release artifact
        uses: actions/upload-artifact@v4
        with:
          name: WiiLayoutEditor-Build
          path: WiiLayoutEditor\bin\Release






